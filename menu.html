<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coffee Haven | Menu</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<header>
  <a class="logo">☕ Coffee Haven</a>
  <nav class="navbar">
    <a href="index.html">Home</a>
    <a href="menu.html" class="active">Menu</a>
    <a href="cart.html">Cart <span id="cart-count">0</span></a>

    <div id="signin-wrapper">
      <a id="signin-btn">Sign In</a>
      <div class="dropdown" id="dropdown-menu">
        <button id="signout-btn">Sign Out</button>
      </div>
    </div>
  </nav>
</header>

<!-- ===== Menu Section ===== -->
<section class="menu">
  <h2>Our Coffee Menu</h2>
  <div class="menu-container">
    <div class="menu-item">
      <img src="images/coffee1.png" alt="Espresso" />
      <h3>Espresso</h3>
      <p class="price">₹120</p>
      <div class="quantity-control">
        <label>Qty:</label>
        <select class="qty-select">
          <option>1</option>
          <option>2</option>
          <option>3</option>
          <option>4</option>
          <option>5</option>
        </select>
      </div>
      <div class="action-buttons">
        <button class="add-cart" data-name="Espresso" data-price="120" data-img="images/coffee1.png">Add to Cart</button>
        <button class="buy-now" data-name="Espresso" data-price="120" data-img="images/coffee1.png">Buy Now</button>
      </div>
    </div>

    <div class="menu-item">
      <img src="images/coffee2.png" alt="Cappuccino" />
      <h3>Cappuccino</h3>
      <p class="price">₹150</p>
      <div class="quantity-control">
        <label>Qty:</label>
        <select class="qty-select">
          <option>1</option>
          <option>2</option>
          <option>3</option>
          <option>4</option>
          <option>5</option>
        </select>
      </div>
      <div class="action-buttons">
        <button class="add-cart" data-name="Cappuccino" data-price="150" data-img="images/coffee2.png">Add to Cart</button>
        <button class="buy-now" data-name="Cappuccino" data-price="150" data-img="images/coffee2.png">Buy Now</button>
      </div>
    </div>

    <div class="menu-item">
      <img src="images/coffee3.png" alt="Latte" />
      <h3>Latte</h3>
      <p class="price">₹140</p>
      <div class="quantity-control">
        <label>Qty:</label>
        <select class="qty-select">
          <option>1</option>
          <option>2</option>
          <option>3</option>
          <option>4</option>
          <option>5</option>
        </select>
      </div>
      <div class="action-buttons">
        <button class="add-cart" data-name="Latte" data-price="140" data-img="images/coffee3.png">Add to Cart</button>
        <button class="buy-now" data-name="Latte" data-price="140" data-img="images/coffee3.png">Buy Now</button>
      </div>
    </div>

    <div class="menu-item">
      <img src="images/coffee4.png" alt="Mocha" />
      <h3>Mocha</h3>
      <p class="price">₹160</p>
      <div class="quantity-control">
        <label>Qty:</label>
        <select class="qty-select">
          <option>1</option>
          <option>2</option>
          <option>3</option>
          <option>4</option>
          <option>5</option>
        </select>
      </div>
      <div class="action-buttons">
        <button class="add-cart" data-name="Mocha" data-price="160" data-img="images/coffee4.png">Add to Cart</button>
        <button class="buy-now" data-name="Mocha" data-price="160" data-img="images/coffee4.png">Buy Now</button>
      </div>
    </div>
  </div>
</section>

<!-- ===== Sign In Modal ===== -->
<div id="signin-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2 id="modal-title">Sign In</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button id="action-btn">Sign In</button>
    <p style="margin-top:10px;">
      <span id="toggle-text">New here?</span>
      <a href="#" id="toggle-auth">Create Account</a>
    </p>
  </div>
</div>

<footer>
  <p>© 2025 Coffee Haven | Freshly brewed happiness ☕</p>
</footer>

<script>
  const API_URL = "http://localhost:5000";

  // DOM Elements
  const modal = document.getElementById("signin-modal");
  const signinBtn = document.getElementById("signin-btn");
  const signoutBtn = document.getElementById("signout-btn");
  const dropdown = document.getElementById("dropdown-menu");
  const toggleAuth = document.getElementById("toggle-auth");
  const toggleText = document.getElementById("toggle-text");
  const actionBtn = document.getElementById("action-btn");
  const modalTitle = document.getElementById("modal-title");
  const emailInput = document.getElementById("email");
  const passInput = document.getElementById("password");
  const cartCount = document.getElementById("cart-count");

  let isSignup = false;

  // Update navigation based on login state
  function updateNavbar() {
    const user = localStorage.getItem("loggedUser");
    if (user) {
      signinBtn.textContent = user.split("@")[0];
      signinBtn.style.background = "#4caf50";
    } else {
      signinBtn.textContent = "Sign In";
      signinBtn.style.background = "#6f4e37";
    }
  }

  // Update cart count
  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    cartCount.textContent = totalItems;
  }

  // Initialize page
  document.addEventListener('DOMContentLoaded', function() {
    updateNavbar();
    updateCartCount();
  });

  // Sign in button click handler
  signinBtn.onclick = () => {
    const user = localStorage.getItem("loggedUser");
    if (user) {
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    } else {
      modal.style.display = "flex";
    }
  };

  // Modal close
  document.querySelector(".close-btn").onclick = () => {
    modal.style.display = "none";
  };

  // Toggle between sign in and sign up
  toggleAuth.onclick = (e) => {
    e.preventDefault();
    isSignup = !isSignup;
    modalTitle.textContent = isSignup ? "Create Account" : "Sign In";
    actionBtn.textContent = isSignup ? "Register" : "Sign In";
    toggleText.textContent = isSignup ? "Already have an account?" : "New here?";
    toggleAuth.textContent = isSignup ? "Sign In" : "Create Account";
  };

  // Sign in/register action
  actionBtn.onclick = async () => {
    const email = emailInput.value.trim();
    const password = passInput.value.trim();
    if (!email || !password) return alert("Fill all fields");

    const endpoint = isSignup ? "/signup" : "/login";
    try {
      const res = await fetch(API_URL + endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json"},
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();

      if (!data.success) return alert(data.message);

      localStorage.setItem("loggedUser", email);
      modal.style.display = "none";
      updateNavbar();
      emailInput.value = "";
      passInput.value = "";
    } catch (error) {
      alert("Server error. Please try again.");
    }
  };

  // Sign out
  signoutBtn.onclick = () => {
    localStorage.removeItem("loggedUser");
    dropdown.style.display = "none";
    updateNavbar();
  };

  // Close dropdown when clicking outside
  document.addEventListener('click', function(event) {
    if (!event.target.closest('#signin-wrapper')) {
      dropdown.style.display = 'none';
    }
  });

  // Cart functionality
  document.querySelectorAll(".add-cart").forEach(btn => {
    btn.onclick = () => {
      const user = localStorage.getItem("loggedUser");
      if (!user) {
        modal.style.display = "flex";
        return;
      }

      const parent = btn.closest(".menu-item");
      const qty = parseInt(parent.querySelector(".qty-select").value) || 1;
      const name = btn.dataset.name;
      const price = parseFloat(btn.dataset.price);
      const image = btn.dataset.img;

      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      
      const existingItem = cart.find(item => item.name === name);
      if (existingItem) {
        existingItem.quantity += qty;
      } else {
        cart.push({ name, price, image, quantity: qty });
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      alert(`${qty} x ${name} added to cart!`);
    };
  });

  // Buy now functionality
  document.querySelectorAll(".buy-now").forEach(btn => {
    btn.onclick = () => {
      const user = localStorage.getItem("loggedUser");
      if (!user) {
        modal.style.display = "flex";
        return;
      }
      alert("Order placed successfully! ☕");
    };
  });

  // Initial calls
  updateNavbar();
  updateCartCount();
</script>

</body>
</html>
