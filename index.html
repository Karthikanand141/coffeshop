<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coffee Haven | Home</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<header>
  <a class="logo">☕ Coffee Haven</a>
  <nav class="navbar">
    <a href="index.html" class="active">Home</a>
    <a href="menu.html">Menu</a>
    <a href="cart.html">Cart <span id="cart-count">0</span></a>

    <div id="signin-wrapper">
      <a id="signin-btn">Sign In</a>
      <div class="dropdown" id="dropdown-menu">
        <button id="signout-btn">Sign Out</button>
      </div>
    </div>
  </nav>
</header>

<section class="home">
  <div class="content">
    <h1>Welcome to Coffee Haven</h1>
    <p>Every cup brewed with love ☕</p>
    <a href="menu.html" class="btn">Shop Now</a>
  </div>
</section>

<div id="signin-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>

    <h2 id="modal-title">Sign In</h2>

    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />

    <button id="action-btn">Sign In</button>
    <p style="margin-top:10px;">
      <span id="toggle-text">New here?</span>
      <a href="#" id="toggle-auth">Create Account</a>
    </p>
  </div>
</div>

<footer>
  © 2025 Coffee Haven
</footer>

<script>
  const API_URL = "http://localhost:5000";

  const modal = document.getElementById("signin-modal");
  const signinBtn = document.getElementById("signin-btn");
  const signoutBtn = document.getElementById("signout-btn");
  const dropdown = document.getElementById("dropdown-menu");
  const toggleAuth = document.getElementById("toggle-auth");
  const toggleText = document.getElementById("toggle-text");
  const actionBtn = document.getElementById("action-btn");
  const modalTitle = document.getElementById("modal-title");
  const emailInput = document.getElementById("email");
  const passInput = document.getElementById("password");

  let isSignup = false;

  function updateNavbar() {
    const user = localStorage.getItem("loggedUser");
    if (user) {
      signinBtn.textContent = user.split("@")[0];
      signinBtn.style.background = "#4caf50";
    } else {
      signinBtn.textContent = "Sign In";
      signinBtn.style.background = "#6f4e37";
    }
  }

  // Initialize page
  document.addEventListener('DOMContentLoaded', function() {
    updateNavbar();
    
    // Cart count update (you can modify this based on your cart logic)
    const cartCount = localStorage.getItem('cartCount') || 0;
    document.getElementById('cart-count').textContent = cartCount;
  });

  signinBtn.onclick = () => {
    const user = localStorage.getItem("loggedUser");
    if (user) {
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    } else {
      modal.style.display = "flex";
    }
  };

  document.querySelector(".close-btn").onclick = () => modal.style.display = "none";

  toggleAuth.onclick = (e) => {
    e.preventDefault();
    isSignup = !isSignup;
    modalTitle.textContent = isSignup ? "Create Account" : "Sign In";
    actionBtn.textContent = isSignup ? "Register" : "Sign In";
    toggleText.textContent = isSignup ? "Already have an account?" : "New here?";
    toggleAuth.textContent = isSignup ? "Sign In" : "Create Account";
  };

  actionBtn.onclick = async () => {
    const email = emailInput.value.trim();
    const password = passInput.value.trim();
    if (!email || !password) return alert("Fill all fields");

    const endpoint = isSignup ? "/signup" : "/login";
    try {
      const res = await fetch(API_URL + endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json"},
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();

      if (!data.success) return alert(data.message);

      localStorage.setItem("loggedUser", email);
      modal.style.display = "none";
      updateNavbar();
      emailInput.value = "";
      passInput.value = "";
    } catch (error) {
      alert("Server error. Please try again.");
    }
  };

  signoutBtn.onclick = () => {
    localStorage.removeItem("loggedUser");
    dropdown.style.display = "none";
    updateNavbar();
  };

  // Close dropdown when clicking outside
  document.addEventListener('click', function(event) {
    if (!event.target.closest('#signin-wrapper')) {
      dropdown.style.display = 'none';
    }
  });

  // Initial update
  updateNavbar();
</script>

</body>
</html>
